- [网点分拨大区匹配取数据](#网点分拨大区匹配取数据)
- [网点分拨大区匹配取数据](#网点分拨大区匹配取数据-1)
- [刷课的js](#刷课的js)
- [数据库和canal关系图](#数据库和canal关系图)

### 网点分拨大区匹配取数据
**sql导数平台**
http://dbtool.yundasys.com:8066/

### 网点分拨大区匹配取数据
```sql
<!-- @import "[TOC]" {cmd="toc" depthFrom=1 depthTo=6 orderedList=false} -->

  -- 一级公司-对口城市-财务分拨-业务省-大区关系表
SELECT 
t1.sjdw as bm, -- 取上级网点
y.mc as mc,-- 上级网点名称
CASE WHEN t2.regionCode is null then '0' ELSE t2.regionCode END as region_bm, -- 对口城市编码
CASE WHEN t2.regionName is null then  '0' ELSE t2.regionName END as region_mc,-- 对口城市编码
CASE WHEN t3.zzz is null then '0' ELSE t3.zzz END as fb_bm, -- 分拨编码
CASE WHEN t4.mc is null then '0' ELSE t4.mc END as fb_mc, -- 分拨名称
CASE WHEN j.package_short is null then t4.mc ELSE j.package_short END as fb_mc, -- 分拨简称
CASE WHEN t5.ProvinceID_b is null then '0' ELSE t5.ProvinceID_b END as province_bm,
CASE WHEN t6.ProvinceName_b  is null then '0' ELSE  t6.ProvinceName_b END as province_mc,-- 省份名称
CASE WHEN t6.short_name is null then '0' ELSE  t6.short_name END as province_short_mc, -- 省份简称
t6.Provincerank_b,-- 省份顺序
t7.rg_id as bigarea_id,
t8.rg_name as bigarea_mc
from ydserver.gs t1 
	  left  join  ydserver.region_statements t2 on t1.sjdw=t2.branchCode
	  inner join  ydserver.wdzzz_cw t3 on t1.sjdw=t3.wdbm 
      inner JOIN  ydserver.gs t4 ON t3.zzz = t4.bm and t4.lb = 3   
      LEFT JOIN  ydserver.county t5 ON t4.szd = t5.CountyID
	  left join  ydserver.gsjcb j on t3.zzz=j.gs
      LEFT JOIN  ydserver.province_business t6 ON t5.ProvinceID_b = t6.ProvinceID_b
      LEFT JOIN  ydserver.province t7 ON t7.ProvinceID = t6.ProvinceID
      LEFT JOIN  ydserver.tb_region t8 ON t8.rg_id = t7.rg_id
	  left join  ydserver.gs y on t1.sjdw = y.bm
     GROUP BY 1,2,3,4,5,6,7,8,9,10,11,12,13;
```

### 刷课的js
```js
// 自动点击人机验证，自动点击播放下一节
setInterval(function () {
  var btn = $(".layui-layer-dialog > .layui-layer-btn > .layui-layer-btn0");
  if (btn.length) {
    btn.click();
    console.log('点击"继续学习"');
  } else {
    console.log('未找到 "继续学习" 按钮');
  }
}, 5000);

function studyEndedHandle() {
  var curLearning = $(".learning.current");
  if (curLearning.length) {
    console.log(curLearning.find("a")[0].innerText + "播放完了");
  }
  setTimeout(function () {
    var nextLi = curLearning.next();
    if (nextLi.length) {
      var next = nextLi.find("a");
      if (next.length) {
        var name = next[0].innerText;
        next.click();
        console.log("点击 播放下一节：" + name);
        console.log("等待网络请求, 5秒后点击 播放");
        setTimeout(function () {
          console.log("点击 播放按钮");
          foot.player.playOrPause();
          foot.player.addListener("ended", studyEndedHandle);
        }, 5000);
      }
    } else {
      console.log("没有找到下一节，你可能已经全部学完了");
    }
  }, 1000);
}

foot.player.addListener("ended", studyEndedHandle);
```
### 数据库和canal关系图
![](imgs/paste-2022-07-28-09-36-37.png)
![](imgs/paste-2022-07-28-09-36-58.png)
## 网点和大区等各级的关联关系
### 大掌柜自己的省市大区关联关系
```sql
SELECT
        county.CountyID as county_id,
        county.CountyName as county_name,
        county.CityID as city_id,
        city.CityName as city_name,
        province.ProvinceID as province_id,
        province.ProvinceName as province_name,
        province.miniName as mini_name,
        pb.ProvinceID_b as province_id_b,
        pb.ProvinceName_b as province_name_b,
        county.StdCountyID as std_county_id,
        county.CLC_ID clc_id,
        city.AreaCode area_code,
        province.bigarea as big_area,
        province.rg_id  as rg_id
    FROM
        ydserver.county county
        LEFT JOIN ydserver.city city ON county.CityID = city.CityID
        LEFT JOIN ydserver.province province ON province.ProvinceID = city.ProvinceID
        LEFT JOIN ydserver.province_business pb ON county.ProvinceID_b = pb.ProvinceID_b
```
### 大掌柜网点和区县的关联关系
```sql
SELECT a.bm, a.sjdw, a.lb as type, a.mc as gsmc, c.mc AS sjmc, c.lb as sjType,  b.*
    FROM yh_gs a
    INNER JOIN yh_basic_county b ON a.szd = b.county_id
    LEFT JOIN yh_gs c ON a.sjdw = c.bm
    WHERE a.lb in (2,21,22) AND a.sjgs != 0
```
```sql
-- 网点对应大区等
SELECT
	a.bm AS '网点编码',
	a.mc AS '网点名称',
CASE
		a.lb 
		WHEN 2 THEN
		'一级公司' 
		WHEN 21 THEN
		'分部' 
		WHEN 22 THEN
		'服务部' ELSE '其他' 
	END '网点类型',
	a.sjdw AS '上级网点编码',
	c.mc AS '上级网点名称',
	b.county_id AS '区县id',
	b.county_name AS '区县名称',
	b.city_id AS '城市id',
	b.city_name AS '城市名称',
	b.province_id AS '省份id',
	b.province_name AS '省份名称',
	b.mini_name AS '省份简称',
	b.province_id_b AS '业务省id',
	b.province_name_b AS '业务省名称',
	b.std_county_id AS '国家统计局县区编码',
	b.clc_id  AS '县级市表id',
	b.area_code AS '区号',
	b.big_area AS '大区名称',
	b.rg_id AS '大区ID' 
FROM
	yh_gs a
	INNER JOIN (
	SELECT
		county.CountyID AS county_id,
		county.CountyName AS county_name,
		county.CityID AS city_id,
		city.CityName AS city_name,
		province.ProvinceID AS province_id,
		province.ProvinceName AS province_name,
		province.miniName AS mini_name,
		pb.ProvinceID_b AS province_id_b,
		pb.ProvinceName_b AS province_name_b,
		county.StdCountyID AS std_county_id,
		county.CLC_ID clc_id,
		city.AreaCode area_code,
		province.bigarea AS big_area,
		province.rg_id AS rg_id 
	FROM
		ydserver.county county
		LEFT JOIN ydserver.city city ON county.CityID = city.CityID
		LEFT JOIN ydserver.province province ON province.ProvinceID = city.ProvinceID
		LEFT JOIN ydserver.province_business pb ON county.ProvinceID_b = pb.ProvinceID_b 
	) b ON a.szd = b.county_id
	LEFT JOIN ydserver.gs c ON a.sjdw = c.bm 
WHERE
	a.lb IN ( 2, 21, 22 ) 
	AND a.sjgs != 0
```

